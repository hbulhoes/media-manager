# Claude Code - Contexto do Projeto Media Manager

Este arquivo fornece contexto para o Claude Code ao trabalhar neste projeto.

## üìã Sobre o Projeto

**Media Manager** √© um gerenciador de m√≠dias (fotos e v√≠deos) serverless desenvolvido para AWS.

### Tecnologias Principais
- **Backend:** AWS Lambda, DynamoDB, S3, Cognito, EventBridge
- **Frontend:** React 18, TypeScript, Vite, TanStack Query, Tailwind CSS
- **IaC:** AWS CDK
- **Linguagem:** TypeScript

## üèóÔ∏è Estrutura do Projeto

```
media-manager/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/        # AWS CDK stacks
‚îÇ   ‚îú‚îÄ‚îÄ lambdas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/              # REST API endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ plugins/          # Sistema de plugins
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ processors/       # Processamento de m√≠dia
‚îÇ   ‚îî‚îÄ‚îÄ schemas/              # Schemas DynamoDB
‚îî‚îÄ‚îÄ frontend/
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ components/       # Componentes React
        ‚îú‚îÄ‚îÄ hooks/           # Custom hooks
        ‚îú‚îÄ‚îÄ services/        # API clients
        ‚îú‚îÄ‚îÄ types/           # TypeScript types
        ‚îî‚îÄ‚îÄ utils/           # Utilit√°rios
```

## üéØ Padr√µes do Projeto

### Backend

#### Lambda Functions
- Sempre usar TypeScript
- Incluir tratamento de erros robusto
- Adicionar logging adequado
- Retornar CORS headers
- Validar inputs

Exemplo:
```typescript
export const handler = async (event: APIGatewayProxyEvent) => {
  try {
    // L√≥gica
    return {
      statusCode: 200,
      headers: corsHeaders(),
      body: JSON.stringify({ /* resultado */ })
    };
  } catch (error) {
    console.error('Error:', error);
    return {
      statusCode: 500,
      headers: corsHeaders(),
      body: JSON.stringify({ error: error.message })
    };
  }
};
```

#### Plugins
- Implementar interface `DestinationPlugin`
- Incluir m√©tricas
- Tratamento de erros detalhado
- Documentar configura√ß√£o necess√°ria
- Adicionar testes

Ver: `backend/lambdas/plugins/s3-plugin.ts` como refer√™ncia

#### DynamoDB
- Usar padr√£o single-table design
- PK: `USER#{userId}`
- SK: `MEDIA#{timestamp}#{mediaId}`
- GSIs para queries eficientes
- Sempre filtrar por userId

### Frontend

#### Componentes React
- Componentes funcionais com hooks
- TypeScript com tipos expl√≠citos
- Tailwind CSS para estiliza√ß√£o
- Props interface documentada
- C√≥digo responsivo

Exemplo:
```typescript
interface MyComponentProps {
  data: string;
  onAction: () => void;
}

export const MyComponent: React.FC<MyComponentProps> = ({ data, onAction }) => {
  return (
    <div className="p-4">
      {/* conte√∫do */}
    </div>
  );
};
```

#### State Management
- React Query para server state
- useState/useReducer para UI state
- Evitar prop drilling

#### Estiliza√ß√£o
- Tailwind utility classes
- Responsivo: mobile-first
- Classes: `sm:`, `md:`, `lg:`, `xl:`

## üìù Conven√ß√µes de C√≥digo

### Nomenclatura
- **Arquivos:** kebab-case (ex: `media-card.tsx`)
- **Componentes:** PascalCase (ex: `MediaCard`)
- **Fun√ß√µes:** camelCase (ex: `getUserMedia`)
- **Constantes:** UPPER_SNAKE_CASE (ex: `API_BASE_URL`)
- **Interfaces:** PascalCase com "Props" ou "Config" sufixo

### Imports
- Agrupar por: React, bibliotecas, local
- Usar imports relativos para arquivos do projeto
- Ordem alfab√©tica dentro de cada grupo

```typescript
// React
import React, { useState, useEffect } from 'react';

// Bibliotecas
import { useQuery } from '@tanstack/react-query';
import axios from 'axios';

// Local
import { MediaCard } from '../components/MediaCard';
import type { MediaItem } from '../types/media';
import { formatDate } from '../utils/formatters';
```

### Coment√°rios
- JSDoc para fun√ß√µes p√∫blicas
- Coment√°rios inline para l√≥gica complexa
- TODO/FIXME quando apropriado

## üß™ Testes

### Estrutura de Testes
```typescript
describe('ComponentName', () => {
  it('should do something', () => {
    // Arrange
    const data = setupData();
    
    // Act
    const result = performAction(data);
    
    // Assert
    expect(result).toBe(expected);
  });
});
```

### Coverage
- Objetivo: >80% coverage
- Testar casos de sucesso e erro
- Testar edge cases

## üöÄ Features em Desenvolvimento

Consulte `docs/ROADMAP.md` para lista completa.

### Prioridades Atuais
1. Importa√ß√£o de dispositivos USB
2. An√°lise de imagens com IA (Rekognition)
3. Plugin Google Drive
4. Editor de imagens b√°sico

## üîê Seguran√ßa

### Pr√°ticas Importantes
- Nunca commitar secrets/credentials
- Usar AWS Secrets Manager/SSM Parameter Store
- Validar todos os inputs
- Sanitizar dados do usu√°rio
- Usar presigned URLs para S3
- Implementar rate limiting
- Logs n√£o devem conter dados sens√≠veis

### Autentica√ß√£o
- Cognito JWT tokens
- Validar userId em todas as opera√ß√µes
- Isolar dados por usu√°rio

## üì¶ Depend√™ncias

### Adicionar Nova Depend√™ncia
```bash
# Backend
cd backend
npm install --save nome-da-lib

# Frontend
cd frontend
npm install nome-da-lib
```

Sempre especificar vers√£o exata em production.

## üêõ Debug

### Backend
```bash
# Ver logs Lambda
aws logs tail /aws/lambda/FunctionName --follow

# Testar localmente (se aplic√°vel)
sam local invoke FunctionName -e event.json
```

### Frontend
- Chrome DevTools
- React DevTools extension
- Redux DevTools (se usar Redux)

## üìä Observabilidade

### Logging
- Sempre logar erros
- Logar opera√ß√µes importantes
- Usar n√≠veis apropriados (INFO, WARN, ERROR)
- Incluir contexto (userId, requestId)

### M√©tricas
- CloudWatch Metrics customizadas
- X-Ray para tracing distribu√≠do
- Monitorar dura√ß√£o de Lambdas
- Monitorar uso de DynamoDB

## üé® Design System

### Cores (Tailwind)
- Primary: blue (ex: `bg-blue-600`)
- Success: green (ex: `bg-green-500`)
- Warning: yellow (ex: `bg-yellow-500`)
- Error: red (ex: `bg-red-500`)
- Neutral: gray (ex: `bg-gray-100`)

### Espa√ßamento
- Pequeno: `p-2` / `m-2` (8px)
- M√©dio: `p-4` / `m-4` (16px)
- Grande: `p-8` / `m-8` (32px)

### Tipografia
- Heading: `text-2xl font-bold`
- Subheading: `text-xl font-semibold`
- Body: `text-base`
- Small: `text-sm`

## üîÑ Workflow Git

### Branches
- `main` - produ√ß√£o
- `develop` - desenvolvimento
- `feature/*` - novas features
- `fix/*` - corre√ß√µes

### Commits
Formato: `<type>: <description>`

Types:
- `Add:` nova feature
- `Fix:` corre√ß√£o de bug
- `Update:` atualiza√ß√£o
- `Refactor:` refatora√ß√£o
- `Docs:` documenta√ß√£o
- `Test:` testes
- `Style:` formata√ß√£o

Exemplo: `Add: implementar importa√ß√£o de dispositivos USB`

## üìö Refer√™ncias √öteis

### AWS
- Lambda: https://docs.aws.amazon.com/lambda/
- DynamoDB: https://docs.aws.amazon.com/dynamodb/
- S3: https://docs.aws.amazon.com/s3/
- CDK: https://docs.aws.amazon.com/cdk/

### Frontend
- React: https://react.dev/
- TanStack Query: https://tanstack.com/query/
- Tailwind: https://tailwindcss.com/

### TypeScript
- Handbook: https://www.typescriptlang.org/docs/

## üí° Ao Implementar Nova Feature

1. **Planejar** - Discutir arquitetura
2. **Backend** - Criar Lambdas, atualizar CDK
3. **Schema** - Atualizar DynamoDB se necess√°rio
4. **API** - Criar/atualizar endpoints
5. **Frontend** - Criar componentes
6. **Testes** - Adicionar testes
7. **Docs** - Atualizar documenta√ß√£o
8. **Deploy** - Testar em staging primeiro

## üéØ Contexto Importante para Claude

### Sistema de Plugins
O cora√ß√£o da arquitetura. Permite adicionar novos destinos de storage sem modificar o core.

Cada plugin deve:
- Implementar `DestinationPlugin` interface
- Ter sua pr√≥pria configura√ß√£o por usu√°rio
- Emitir eventos via EventBridge
- Incluir retry logic
- Ter m√©tricas pr√≥prias

### Event-Driven Architecture
Uploads disparam eventos que:
1. Processam m√≠dia (thumbnails, EXIF)
2. Salvam no DynamoDB
3. Disparam sincroniza√ß√£o de plugins
4. (Opcional) Disparam an√°lise de IA

### Grid Virtualizado
Usar TanStack Virtual para performance com milhares de itens.
Sempre considerar virtualiza√ß√£o para listas grandes.

## ‚ö†Ô∏è Limita√ß√µes Conhecidas

- Lambda timeout: 15 minutos m√°ximo
- Lambda memory: 10GB m√°ximo
- DynamoDB item size: 400KB m√°ximo
- S3 presigned URL: 7 dias m√°ximo
- API Gateway payload: 10MB m√°ximo

## üÜò Se Algo N√£o Funcionar

1. Verificar logs CloudWatch
2. Verificar IAM permissions
3. Verificar environment variables
4. Verificar versions das depend√™ncias
5. Consultar `docs/DEPLOYMENT.md`

---

**Este contexto ajuda o Claude Code a entender o projeto e seguir os padr√µes estabelecidos!**
